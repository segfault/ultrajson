language: python
python: 3.6
matrix:
  include:
  - sudo: required
    services:
    - docker
    env:
    - PIP=pip
    - CIBW_SKIP=cp27-*
  - os: osx
    language: generic
    env:
    - PIP=pip2
    - CIBW_SKIP=cp27-*
env:
  global:
  - TWINE_USERNAME=segfaults
  - secure: WNqFAnkaxFVwM+Tdd5TpLYe55/UZ63/wnLZ9BnvKRZOuV6amF0QXlA/YUeTgxdjHOehhsbLMKDMjKS6vspx07lHG47PhmRittP5PkJXg3fas7eMzprbIgickJCJDdHA1aXtcKDvdKRCLA1zcuxiQDIUgSfBGGKHIwZZypWlfVZMBlIm2Sbib7w2hzbYlUNE+VkCqXtNuoJ6+NGMJLtwpIc3VZpm8ttgJ0WchZTW4dH6CXRaW/P7QWZ4y2DvuYxm4yAFuKOmcT8+qKy2ICh2bvfjGQtr+TCFEFy+n1meqZIWBHYdTH30YzBVAlRUmH/v9w7X5aoRgtKphbJ5onBJair2XW/eu4mGXeryZycdK/vcQ5O0YW26VP2e6HcY0EIzKmPZVyb01Z9D+6+2CQLxMiFR21dwtJUNMoDIrjM9i0O4ReMeIwCi3am+8tOrEvmOo+s8CwG5FnZ1rFqjTJwNL+Sc3ilADSqreZzNhTqJBovmGjnoh6lTD/1oIXrQk7hEQCEva3DVF9yUJAvgFSK6nP5+JQE08NcRwy+sW6aYdCZhLSVElHzzy9YofRDGxqqFAkxv2jS+0L256pW0eAUgD2LCPPJkNbxpEOXd+sVWg40Ag+JxAWR8GQxIvlD8Mxk50D9vKsx0I7aG12yu/3hTFHPr0X/Eza3aQJPNgBXClbnc=
  - secure: bwjfTvcAkOKUI4tvf1slChqAtfQSQCMJIy7MSgYobjwWglEcTmNZC6odqLLShledWo7u56ZjG97STBtgDQSW5Ueo2WFBoBMdD24p40rRF9pKbcVub64R7GfqueHUP14dIUoJawl5R1Exbo5rP5df5AUMpd3nS71Ioc5cUUpb8FyUBE78DObR8riSQEKqMd+3GCLyRFuo9gw7hpLLJLgO4cTFbW1I6IH5nt+TKYyJPjBO1HIfChTX23NLnmp+emdyWHhh6gvvO4svEzyGoHXrhlnKWqkpxUpGMlhsZ72VxprQElZKSp1cd9kEzd2x904sZAPlye8I5vla+gZc3XkHzqvpX0fQkSCLat6FgEvRA1Yz3QE+cG3nBISlN7I+T1Q61PljGJ8Sv2HSta2BNqf4RXjEIxO2MzY3ekmSWkT1enDQnQGS5L0/ehK1qdA/Efm1c9btCsLCTnhn8o7frXFk9eQo3x1znKoAmrmJ3R+ii6UbE5VVN7FGbdRRqBOJIJA/vDjkT1romwBYOTHwodr4zMNPpzRDfiR+xhLbOlTwLq9mn7Hr5mtD3lnZCFwHFWvXok5+NEVXaFd8mZoFJs8bWKcPkYsQhPDzyAVdzxN8MMEEo6rbEDgX0jwPOILXE73weQe0Umu1ssnA5jGQPw4tSCpTbflD2VBTaIYArYYEtWI=
  - secure: OHdmvTG8Z5G87R3XG+4GHqy398TnSEsRQQ5cnM/BesTLcf4xcENhNdVvY8Elg7UOvFHoEZjDdvN3n/jrT5oM2zqA46fMEmIZ38yq+FmVrqWKEV4GkfnR9EHy2qmrTP5qorjqgcFsuMvO+2NIYyfdgtRv4wQwBT1G0qh6kybI4sc58SGcyhyTvSgW6/8INEcXadW/k9Pj18owZakqVEYhuMj3mzxylB0opbDTx1yoJCQN/Rg9tYpQYzXmdjGL1U4s6iCp1qk60YJ72RNlmwr+cpIuC1yW8XKrtisal6IJzix5i0YjjTScbWHDxpdhYhDP+kFRhM9uCURFo0TDgNgnY5Z/rbGfdayDkgZBSBW5HcRvBvTksECf8jPftSBaZPZrj8q+3gD6JyHkmGRtt0j27gBDclY+rwYYoSO/9DxkCZTT2qQX9uqWcQ9B1aXMpScXM9qFiLR2OsMvOvrjMI7nbIpTU5H+k3fzUyWN9jkTf3NgD+tUOMobjbc3gg7uaxfsuNS/JZtWbYotVdGvTlscXIugzGXpCdxYAbBfvRdtdJZkT8NCWl04HUy57ScoOz6lxq/GW8oJ1RgVywiKWxkbq1O24l+8SL1pzjh9o/GUFgHvzAbSPUEAmtXI9mBQ+EEhLFQMygk3pBQEmNTfdVEPHP9piL7WlvsK2WXdaVCYFDE=
script:
- "$PIP install cibuildwheel==0.10.1"
- echo "#define UJSON_VERSION \"2.1.${TRAVIS_BUILD_NUMBER}\"" > python/version.h
- export CIBW_ENVIRONMENT="CI=\"$CI\" TRAVIS_BRANCH=\"$TRAVIS_BRANCH\" TRAVIS_COMMIT=\"$TRAVIS_COMMIT\""
- cibuildwheel --output-dir wheelhouse
- |
  if [[ ! -z "$TRAVIS_TAG" ]]; then
    export TWINE_USERNAME=segfaults
    export TWINE_PASSWORD="$TWINE_LIVE_PASSWORD"
    export TWINE_WHY_ARE_YOU_DOING_THIS="$I_REALY_WOULD_LIKE_TO_UNDERSTAND"
    $PIP install twine
    echo "TWINE_USERNAME=${TWINE_USERNAME}"
    echo "TWINE_PASSWORD=${TWINE_PASSWORD}"
    echo "TWINE_LIVE_PASSWORD=${TWINE_LIVE_PASSWORD}"
    echo "I_REALY_WOULD_LIKE_TO_UNDERSTAND=$I_REALY_WOULD_LIKE_TO_UNDERSTAND"
    echo "INDIRECT_SECRET_REF=$TWINE_WHY_ARE_YOU_DOING_THIS"
    python -m twine upload wheelhouse/*.whl --skip-existing --verbose
  elif [[ "$TRAVIS_BRANCH" = "master" ]] && [[ -z "$TRAVIS_PULL_REQUEST_SHA" ]]; then
    export TWINE_USERNAME=segfault
    export TWINE_PASSWORD="$TWINE_TEST_PASSWORD"
    $PIP install twine
    python -m twine upload wheelhouse/*.whl --repository-url https://test.pypi.org/legacy/ --skip-existing --verbose
  fi
notifications:
  slack:
    secure: adph3tDEsKVxHQwR+5fdFpnnmt0xOfxpQXt2NkoJ9RS0u4bIXaYvwIUVc2vJ/QJyeIQEGV7/I2aDD3WTaJEUzH52OXIiK5cxmL2pML+1OJTrpuL9JAUgOYDbQyb6OiqgFDIBTACqWWnjqQWC8syqlh9JrAhVSmwLCix27CuELiu4c6RnN/Hp7oCPg2lvqNm1/hxK03+WAoY/FiOqZsAAM9DwZLe6RdJEYZQI2shO1XjAY9uZRN94jatpEjRiogDtzQizJI5gwSL96WXijTpppkEJ4jhlSu3zwgNZCM4Yx6bDRaYG2LFOTQN2q9cxpy0fS9USgYyu2QkOJmCi/gF2GFWhjhhfANY6vnYYqT2i87GhvBY1GJl4YYnFdSomJv0O/D9M04aAMJDqmoNAz3RGEVN+2w4prWCGlpNgy4RMZDV3bhtoH8ULxlrwl4PX8fpvrIuwCqv5PQRUFvWPKFKRqo7BeKuayIzFEIXcfdSeDFQcfYFQmN+fg0OC3kVawDJMVM/1WLAxvcA0iClIyyJdWEODk6WwpoQnYOGORL1/k+O9OQFaoRSTOm5Nn/QksL8m4gn6Py7eC0R3Bh00K253iXuPHz6O8Itxor7wLSCRNSXhv+wynfbVa8sPPoWOyPy1wuD30HGfD8WzjSNaA/iUWoeTtrSXAVjfK/KPLEzD99A=
